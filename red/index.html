<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=1920,height=1080"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>red</title>
<link rel="stylesheet" type="text/css" href="../common/1920.min.css" />
<link rel="stylesheet" type="text/css" href="../common/beautons.min.css" />
<link rel="stylesheet" type="text/css" href="../common/base.css" />
<style type="text/css">
</style>
</head>
<body>
<!--映像音声指定-->
<object id="av" type="video/x-iptvf-broadcast" style="position:absolute; width:1920px; height:1080px; left:0px; top:0px;"></object>

<audio id="sound_rom"></audio>
<audio id="audio_move"  preload="auto"><source src="../common/audio/move1.aiff"  type="audio/X-arib-aiff"></audio>
<audio id="audio_enter" preload="auto"><source src="../common/audio/enter1.aiff" type="audio/X-arib-aiff"></audio>
<audio id="audio_close" preload="auto"><source src="../common/audio/close1.aiff" type="audio/X-arib-aiff"></audio>
<audio id="openaudio" autoplay><source src="../common/audio/open1.aiff" type="audio/X-arib-aiff"></audio>

</object>
<body>
<div class="container">
	<div class="container_12">

		<!-- ////////////////////////////////////////////////////// -->

		<div class="container_12 abs" style="top:32px;">
			<div class="grid_12 layer2" style="height:96px;"><div id="comment"></div></div>
			<div class='clear'>&nbsp;</div>
		</div>

		<div class="container_12 abs" style="top:144px;">
			<div class="grid_12 layer2" style="height:832px;"><div id="images"></div></div>
			<div class='clear'>&nbsp;</div>
		</div>

		<!-- ////////////////////////////////////////////////////// -->

		<div class="container_12 abs" style="top:1000px;">
			<div class="grid_3">
				<div id="btn0" class="btn btn--full btn-b"> Blue </div>
			</div>
			<div class="grid_3">
				<div id="btn1" class="btn btn--full btn-r"> Red </div>
			</div>
			<div class="grid_3">
				<div id="btn2" class="btn btn--full btn-g"> Green </div>
			</div>
			<div class="grid_3">
				<div id="btn3" class="btn btn--full btn-y"> Yellow </div>
			</div>
			<div class='clear'>&nbsp;</div>
		</div>

	</div>
</div>
<script type="text/javascript" src="../common/zepto-1.1.3.min.js"></script>
<script type="text/javascript" src="../common/zepto-selector.js"></script>
<script type="text/javascript" src="../common/moment.min.js"></script>
<script type="text/javascript" src="../common/base.js"></script>
<script>
$(function(){

// 初期操作
var colorArray = new Array(
	"../blue/",
	"../red/",
	"../green/",
	"../yellow/"
);

var focus = 1;
$("div#btn"+focus).addClass("btn--active");


//リモコンキー押下検知開始
document.addEventListener("keydown", eventKey, false);

function eventKey(e){
	e.preventDefault();
	var key=e.keyCode;

	if(key==VK_DBUTTON){
		playRomSound(7);
		navigator.applicationManager.launchDataBroadcastingBrowser({});//映像本線（データ放送）に戻る
	}
	else if(key==VK_UP){
		playRomSound(9);
	}
	else if(key==VK_DOWN){
		playRomSound(9);
	}
	else if(key==VK_LEFT||key==VK_RIGHT){//カーソル　左右移動
		document.getElementById("audio_move").play();
		$("div#btn"+focus).removeClass("btn--active");
		if(key==VK_LEFT){
			focus--;
		}
		else{
			focus++;
		}
		if(focus<0){
			focus=colorArray.length-1;
		}
		else if(focus>colorArray.length-1){
			focus=0;
		}
		$("div#btn"+focus).addClass("btn--active");
	}
	else if(key==VK_ENTER){
		go(focus);
	}
	else if(key==VK_BLUE){
		go(0);
	}
	else if(key==VK_RED){
		go(1);
	}
	else if(key==VK_GREEN){
		go(2);
	}
	else if(key==VK_YELLOW){
		go(3);
	}
	else if(key==VK_BACK){
		playRomSound(7);
		document.getElementById("audio_enter").play();
		if(window.history.length!=0)window.history.back();
	}

}

//番組更新検知開始
if(isHC()){
	var streamEventTarget=navigator.receiverDevice.streamEvent;
	streamEventTarget.addEventIDUpdateListener(function(event_ref){
		getCurrentEvent();
	});
}

var counter = 0;
(function loop() {
	setImage("g1", moment().subtract(5,'s').format("YYYY-MM-DDTHH:mm:ss") );
	if(counter>=108){
		$('div#images img:last').remove();
	}
	setTimeout(loop, 1000);
	counter++;
})();

function setImage(service,date){
	$("div#images").prepend('<img src="http://211.129.73.42:21080/s2ia/'+service+'/'+date+'" width="150px"/>');
}

//放送波　現番組・次番組情報取得
function getCurrentEvent(){
	navigator.receiverDevice.getCurrentEventInformation( function(res) {
		$('div#comment').html('<p class="highlight">現番組名:'+res.name+' <br/>次番組名:'+res.f_name+'</p>');
	});
}

function go(next){
	document.getElementById("audio_enter").play();
	$("div#btn"+focus).removeClass("btn--active");
	$("div#btn"+next).addClass("btn-submit");
	location.href=colorArray[next];
}

});
</script>
</body>
</html>
